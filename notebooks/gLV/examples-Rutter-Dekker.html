<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Repeat Rutter &amp; Dekker et al 2024 analysis &#8212; MIMIC 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <script src="../../_static/documentation_options.js?v=01f34227"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Repeat Stein et al. 2013 analysis" href="examples-Stein.html" />
    <link rel="prev" title="Vector AutoRegression (VAR) Simulation" href="../VAR/examples-sim-VAR.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mimic.utilities</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">mimic.model_infer.infer_gLV_bayes</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mimic.model_infer</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mimic.model_simulate</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mimic.model_simulate.sim_gLV</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>


<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">arviz</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">az</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pymc</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytensor.tensor</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">at</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cloudpickle</span>
<br/></pre></div>
</div>
</div>
<section id="Repeat-Rutter-&amp;-Dekker-et-al-2024-analysis">
<h1>Repeat Rutter &amp; Dekker et al 2024 analysis<a class="headerlink" href="#Repeat-Rutter-&-Dekker-et-al-2024-analysis" title="Link to this heading">¶</a></h1>
<p>This example replicates the analysis completed by Rutter &amp; Dekker investigating the action of a bacteriocin released by one bacteria on another. The bacterial co-culture growth curves are used to infer the interaction of the species on each other. The two species are E. coli Nissle, which is a commensal strain engineered to secrete the bacteriocin, with the aim of killing the second species Enterococcus faecalis, which can be harmful to human health. In the paper, different bacteriocin and
secretion tag combinations are tested, but in this example we demonstrate using one condition - PM3-EntA.</p>
<p>The priors selected for Bayesian inference are taken from the paper, which explores this and the model selection in more detail, as well as a thorough introduction to the data.</p>
<p>The original Rutter &amp; Dekker paper can be found here: <a class="reference external" href="https://www.nature.com/articles/s41467-024-50591-8">https://www.nature.com/articles/s41467-024-50591-8</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import and format the data</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_data</span><span class="p">(</span><span class="n">input_data</span><span class="p">):</span>
    <span class="c1"># Read the CSV file</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>

    <span class="c1"># Adjust for data size and number of species as necessary</span>
    <span class="c1"># Here we take only time course up to t=400</span>
    <span class="n">X1_bar</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Calculate the mean of the second species</span>
    <span class="n">X2_bar</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Combine the first column with the calculated means</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s1">&#39;X1_bar&#39;</span><span class="p">:</span> <span class="n">X1_bar</span><span class="p">,</span>
        <span class="s1">&#39;X2_bar&#39;</span><span class="p">:</span> <span class="n">X2_bar</span>
    <span class="p">})</span>

    <span class="c1"># Replace negative values with 0</span>
    <span class="n">obs</span><span class="p">[</span><span class="n">obs</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">obs</span>

<span class="n">PM3_EntA_data</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;PM3-EntA-coculture.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualise the mean of the growth curves of both species grown in co-culture together</span>
<span class="n">plot_growth_curves</span><span class="p">(</span><span class="n">PM3_EntA_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_gLV_examples-Rutter-Dekker_4_0.png" src="../../_images/notebooks_gLV_examples-Rutter-Dekker_4_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract data and convert to numpyarrays</span>

<span class="n">yobsdf</span> <span class="o">=</span> <span class="n">PM3_EntA_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span>
<span class="n">yobs</span> <span class="o">=</span> <span class="n">yobsdf</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">timesa</span> <span class="o">=</span> <span class="n">PM3_EntA_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">timesa</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_gLV</span><span class="p">(</span><span class="n">yobs</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_gLV_examples-Rutter-Dekker_6_0.png" src="../../_images/notebooks_gLV_examples-Rutter-Dekker_6_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">F</span> <span class="o">=</span> <span class="n">linearize_time_course_16S</span><span class="p">(</span><span class="n">yobs</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform Bayesian inference without shrinkage</span>

<span class="c1"># Define priors</span>
<span class="n">prior_mu_mean</span> <span class="o">=</span> <span class="mf">0.03</span>
<span class="n">prior_mu_sigma</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="c1">## NB prior_Mii_mean is 0, so not defined as an argument</span>
<span class="n">prior_Mii_mean</span> <span class="o">=</span>  <span class="mf">0.1</span>
<span class="n">prior_Mii_sigma</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">prior_Mij_sigma</span> <span class="o">=</span> <span class="mf">0.1</span>


<span class="c1"># Sampling conditions</span>
<span class="n">draws</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">tune</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">chains</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">cores</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">inference</span> <span class="o">=</span> <span class="n">infergLVbayes</span><span class="p">()</span>

<span class="n">inference</span><span class="o">.</span><span class="n">set_parameters</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="n">F</span><span class="p">,</span> <span class="n">prior_mu_mean</span><span class="o">=</span><span class="n">prior_mu_mean</span><span class="p">,</span> <span class="n">prior_mu_sigma</span><span class="o">=</span><span class="n">prior_mu_sigma</span><span class="p">,</span>
                          <span class="n">prior_Mii_sigma</span><span class="o">=</span><span class="n">prior_Mii_sigma</span><span class="p">,</span> <span class="n">prior_Mii_mean</span><span class="o">=</span><span class="n">prior_Mii_mean</span><span class="p">,</span>
                          <span class="n">prior_Mij_sigma</span><span class="o">=</span><span class="n">prior_Mij_sigma</span><span class="p">,</span>
                          <span class="n">draws</span><span class="o">=</span><span class="n">draws</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="n">tune</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="n">chains</span><span class="p">,</span><span class="n">cores</span><span class="o">=</span><span class="n">cores</span><span class="p">)</span>

<span class="n">idata</span> <span class="o">=</span> <span class="n">inference</span><span class="o">.</span><span class="n">run_inference</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X shape: (19, 3)
F shape: (19, 2)
Number of species: 2
AdvancedSetSubtensor.0
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [sigma, mu_hat, M_ii_hat_p, M_ij_hat]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e24474889a90477c9d03d53bd011e78a", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 4 chains for 500 tune and 500 draw iterations (2_000 + 2_000 draws total) took 3 seconds.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To plot posterior distributions</span>
<span class="n">inference</span><span class="o">.</span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">idata</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_gLV_examples-Rutter-Dekker_9_0.png" src="../../_images/notebooks_gLV_examples-Rutter-Dekker_9_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_gLV_examples-Rutter-Dekker_9_1.png" src="../../_images/notebooks_gLV_examples-Rutter-Dekker_9_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_gLV_examples-Rutter-Dekker_9_2.png" src="../../_images/notebooks_gLV_examples-Rutter-Dekker_9_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print summary</span>

<span class="n">summary</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">idata</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mu_hat&quot;</span><span class="p">,</span> <span class="s2">&quot;M_ii_hat&quot;</span><span class="p">,</span> <span class="s2">&quot;M_ij_hat&quot;</span><span class="p">,</span> <span class="s2">&quot;M_hat&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">[[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">,</span> <span class="s2">&quot;r_hat&quot;</span><span class="p">]])</span>


<span class="c1"># Save posterior samples to file</span>
<span class="n">az</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">idata</span><span class="p">,</span> <span class="s1">&#39;model_posterior.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/chaniaclare/Documents/GitHub/MIMIC/venv/lib/python3.10/site-packages/arviz/stats/diagnostics.py:596: RuntimeWarning: invalid value encountered in scalar divide
  (between_chain_variance / within_chain_variance + num_samples - 1) / (num_samples)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                 mean     sd  r_hat
mu_hat[0, 0]    0.033  0.003   1.00
mu_hat[0, 1]    0.015  0.003   1.01
M_ii_hat[0]    -0.131  0.079   1.00
M_ii_hat[1]    -0.113  0.036   1.01
M_ij_hat[0, 0] -0.069  0.028   1.00
M_ij_hat[1, 0] -0.053  0.091   1.00
M_hat[0, 0]    -0.069  0.028   1.00
M_hat[0, 1]     0.000  0.000    NaN
M_hat[1, 0]    -0.053  0.091   1.00
M_hat[1, 1]    -0.113  0.036   1.01
sigma[0]        0.007  0.001   1.01
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;model_posterior.nc&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To compare predicted and observed curves</span>

<span class="n">init_species_start</span> <span class="o">=</span> <span class="mf">0.005</span>
<span class="n">sim_gLV_class</span> <span class="o">=</span> <span class="n">sim_gLV</span><span class="p">()</span>
<span class="n">curve_compare</span><span class="p">(</span><span class="n">idata</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">yobs</span><span class="p">,</span> <span class="n">init_species_start</span><span class="p">,</span> <span class="n">sim_gLV_class</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_gLV_examples-Rutter-Dekker_11_0.png" src="../../_images/notebooks_gLV_examples-Rutter-Dekker_11_0.png" />
</div>
</div>
</section>
<section id="Perform-Bayesian-inference-with-shrinkage">
<h1>Perform Bayesian inference with shrinkage<a class="headerlink" href="#Perform-Bayesian-inference-with-shrinkage" title="Link to this heading">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define priors</span>
<span class="n">prior_mu_mean</span> <span class="o">=</span> <span class="mf">0.03</span>
<span class="n">prior_mu_sigma</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">prior_Mii_mean</span> <span class="o">=</span>  <span class="mf">0.1</span>
<span class="n">prior_Mii_sigma</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="c1">## NB prior_Mij_mean is 0, so not defined as an argument</span>
<span class="n">prior_Mij_sigma</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="c1"># Define parameters for shrinkage on M_ij (non diagonal elements)</span>
<span class="n">n_obs</span> <span class="o">=</span> <span class="n">times</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">num_species</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">nX</span> <span class="o">=</span> <span class="n">num_species</span>
<span class="n">noise_stddev</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">DA</span> <span class="o">=</span> <span class="n">nX</span><span class="o">*</span><span class="n">nX</span> <span class="o">-</span> <span class="n">nX</span>

<span class="n">DA0</span> <span class="o">=</span> <span class="mi">1</span>     <span class="c1"># expected number of non zero entries in M_ij</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">n_obs</span> <span class="o">-</span> <span class="mi">2</span>


<span class="c1"># Sampling conditions</span>
<span class="n">draws</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">tune</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">chains</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">cores</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># Run inference</span>

<span class="n">inference</span> <span class="o">=</span> <span class="n">infergLVbayes</span><span class="p">()</span>

<span class="n">inference</span><span class="o">.</span><span class="n">set_parameters</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="n">F</span><span class="p">,</span> <span class="n">prior_mu_mean</span><span class="o">=</span><span class="n">prior_mu_mean</span><span class="p">,</span> <span class="n">prior_mu_sigma</span><span class="o">=</span><span class="n">prior_mu_sigma</span><span class="p">,</span>
                          <span class="n">prior_Mii_sigma</span><span class="o">=</span><span class="n">prior_Mii_sigma</span><span class="p">,</span> <span class="n">prior_Mii_mean</span><span class="o">=</span><span class="n">prior_Mii_mean</span><span class="p">,</span>
                          <span class="n">prior_Mij_sigma</span><span class="o">=</span><span class="n">prior_Mij_sigma</span><span class="p">,</span>
                          <span class="n">DA</span><span class="o">=</span><span class="n">DA</span><span class="p">,</span> <span class="n">DA0</span><span class="o">=</span><span class="n">DA0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">noise_stddev</span><span class="o">=</span><span class="n">noise_stddev</span><span class="p">,</span>
                          <span class="n">draws</span><span class="o">=</span><span class="n">draws</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="n">tune</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="n">chains</span><span class="p">,</span><span class="n">cores</span><span class="o">=</span><span class="n">cores</span><span class="p">)</span>

<span class="n">idata</span> <span class="o">=</span> <span class="n">inference</span><span class="o">.</span><span class="n">run_bayes_gLV_shrinkage</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [sigma, mu_hat, M_ii_hat_p, c2, tau, lam, M_ij_hat]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8293758b98794d66a466af9142af38e3", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 4 chains for 500 tune and 500 draw iterations (2_000 + 2_000 draws total) took 7 seconds.
There were 108 divergences after tuning. Increase `target_accept` or reparameterize.
The effective sample size per chain is smaller than 100 for some parameters.  A higher number is needed for reliable rhat and ess computation. See https://arxiv.org/abs/1903.08008 for details
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print summary</span>

<span class="n">summary</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">idata</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mu_hat&quot;</span><span class="p">,</span> <span class="s2">&quot;M_ii_hat&quot;</span><span class="p">,</span> <span class="s2">&quot;M_ij_hat&quot;</span><span class="p">,</span> <span class="s2">&quot;M_hat&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">[[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">,</span> <span class="s2">&quot;r_hat&quot;</span><span class="p">]])</span>


<span class="c1"># Save posterior samples to file</span>
<span class="n">az</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">idata</span><span class="p">,</span> <span class="s1">&#39;model_posterior.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                 mean     sd  r_hat
mu_hat[0, 0]    0.034  0.004   1.01
mu_hat[0, 1]    0.015  0.003   1.01
M_ii_hat[0]    -0.128  0.078   1.00
M_ii_hat[1]    -0.115  0.034   1.01
M_ij_hat[0, 0] -0.048  0.072   1.01
M_ij_hat[1, 0] -0.124  0.246   1.01
M_hat[0, 0]    -0.048  0.072   1.01
M_hat[0, 1]     0.000  0.000    NaN
M_hat[1, 0]    -0.124  0.246   1.01
M_hat[1, 1]    -0.115  0.034   1.01
sigma[0]        0.007  0.001   1.00
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/chaniaclare/Documents/GitHub/MIMIC/venv/lib/python3.10/site-packages/arviz/stats/diagnostics.py:596: RuntimeWarning: invalid value encountered in scalar divide
  (between_chain_variance / within_chain_variance + num_samples - 1) / (num_samples)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;model_posterior.nc&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">init_species_start</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">sim_gLV_class</span> <span class="o">=</span> <span class="n">sim_gLV</span><span class="p">()</span>
<span class="n">curve_compare</span><span class="p">(</span><span class="n">idata</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">yobs</span><span class="p">,</span> <span class="n">init_species_start</span><span class="p">,</span> <span class="n">sim_gLV_class</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_gLV_examples-Rutter-Dekker_15_0.png" src="../../_images/notebooks_gLV_examples-Rutter-Dekker_15_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">MIMIC</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">Modelling and Inference of MICrobiomes Project (MIMIC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">mimic</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../examples.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../examples.html#jupyter-notebook-examples-by-model">Jupyter Notebook Examples by Model</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../examples.html#consumer-resource-model-crm">Consumer Resource Model (CRM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples.html#gaussian-processes-gp">Gaussian Processes (GP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples.html#multivariate-autoregressive-model-mvar">Multivariate Autoregressive Model (MVAR)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples.html#multi-model-analysis">Multi-Model Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples.html#vector-autoregression-var">Vector Autoregression (VAR)</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../examples.html#generalized-lotka-volterra-glv">Generalized Lotka-Volterra (gLV)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples.html#generalized-metabolic-lotka-volterra-gmlv">Generalized Metabolic Lotka-Volterra (gMLV)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing to MIMIC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../history.html">History</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../../examples.html">Examples</a><ul>
      <li>Previous: <a href="../VAR/examples-sim-VAR.html" title="previous chapter">Vector AutoRegression (VAR) Simulation</a></li>
      <li>Next: <a href="examples-Stein.html" title="next chapter">Repeat Stein et al. 2013 analysis</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Pedro Fontanarrosa.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../_sources/notebooks/gLV/examples-Rutter-Dekker.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>