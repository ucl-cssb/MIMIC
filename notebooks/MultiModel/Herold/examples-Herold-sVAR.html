<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Sparse VAR on a Real Public Dataset, Herold et al. (2020) &#8212; MIMIC 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <script src="../../../_static/documentation_options.js?v=01f34227"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Data imputation on a Real Public Dataset, Herold et al. (2020)" href="examples_impute_data.html" />
    <link rel="prev" title="VAR inference on a Real Public Dataset, Herold et al. (2020)" href="examples-Herold-VAR.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="Sparse-VAR-on-a-Real-Public-Dataset,-Herold-et-al.-(2020)">
<h1>Sparse VAR on a Real Public Dataset, Herold et al. (2020)<a class="headerlink" href="#Sparse-VAR-on-a-Real-Public-Dataset,-Herold-et-al.-(2020)" title="Link to this heading">¶</a></h1>
<p>In this example, we are goint to import the metabolite data and do a sparse VAR inference method to infer the causal relationships between the variables (relative abundances and metabolite concentrations) in the time series dataset available at <a class="reference external" href="https://doi.org/10.1038/s41467-020-19006-2">Herold et al., 2020</a>.</p>
<p>First, we will import the neccessary libraries and load the dataset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>


<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>


<span class="kn">from</span><span class="w"> </span><span class="nn">mimic.data_imputation.impute_GP</span><span class="w"> </span><span class="kn">import</span> <span class="n">GPImputer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mimic.model_infer.infer_VAR_bayes</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
WARNING:tensorflow:From c:\ProgramData\anaconda3\envs\MIMIC\Lib\site-packages\tf_keras\src\losses.py:2976: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

WARNING:tensorflow:From c:\ProgramData\anaconda3\envs\MIMIC\Lib\site-packages\tensorflow_probability\python\internal\backend\numpy\_utils.py:48: The name tf.logging.TaskLevelStatusMessage is deprecated. Please use tf.compat.v1.logging.TaskLevelStatusMessage instead.

WARNING:tensorflow:From c:\ProgramData\anaconda3\envs\MIMIC\Lib\site-packages\tensorflow_probability\python\internal\backend\numpy\_utils.py:48: The name tf.control_flow_v2_enabled is deprecated. Please use tf.compat.v1.control_flow_v2_enabled instead.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING (pytensor.tensor.blas): Using NumPy C-API based implementation for BLAS functions.
</pre></div></div>
</div>
<p>So now, let’s try doing the inference with the VAR method and the imputed data to see if it can infer the causal relationships between the variables in the time series.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">imputed_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;imputed_data.csv&#39;</span><span class="p">)</span>
<span class="c1"># create a pandas dataframe of the original imputed data_set with days as the index</span>
<span class="n">imputed_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;days&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">imputed_MP_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;MP_metabolite_imputed_data.csv&#39;</span><span class="p">)</span>
<span class="n">imputed_MP_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">imputed_MP_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>01_Fermentation</th>
      <th>02_Homoacetogenesis</th>
      <th>03_Superpathway of thiosulfate metabolism (Desulfovibrio sulfodismutans)</th>
      <th>04_Utililization of sugar, conversion of pentose to EMP pathway intermediates</th>
      <th>05_Fatty acid oxidation</th>
      <th>06_Amino acid utilization biosynthesis metabolism</th>
      <th>07_Nucleic acid metabolism</th>
      <th>08_Hydrocarbon degradation</th>
      <th>09_Carbohydrate Active enzyme - CAZy</th>
      <th>10_TCA cycle</th>
      <th>...</th>
      <th>12_Transporters</th>
      <th>13_Hydrogen metabolism</th>
      <th>14_Methanogenesis</th>
      <th>15_Methylotrophy</th>
      <th>16_Embden Meyerhof-Parnos (EMP)</th>
      <th>17_Gluconeogenesis</th>
      <th>18_Sulfur compounds metabolism</th>
      <th>19_Saccharide and derivated synthesis</th>
      <th>20_Hydrolysis of polymers</th>
      <th>21_Cellular response to stress</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.0</th>
      <td>0.096899</td>
      <td>0.009890</td>
      <td>0.000579</td>
      <td>0.000535</td>
      <td>0.025483</td>
      <td>0.122784</td>
      <td>0.119531</td>
      <td>0.005524</td>
      <td>0.003921</td>
      <td>0.045398</td>
      <td>...</td>
      <td>0.015593</td>
      <td>0.000846</td>
      <td>0.003520</td>
      <td>0.009267</td>
      <td>0.030473</td>
      <td>0.016261</td>
      <td>0.005346</td>
      <td>0.009267</td>
      <td>0.006193</td>
      <td>0.037334</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>0.104379</td>
      <td>0.010097</td>
      <td>0.000564</td>
      <td>0.001093</td>
      <td>0.026447</td>
      <td>0.125917</td>
      <td>0.111970</td>
      <td>0.004937</td>
      <td>0.003630</td>
      <td>0.046199</td>
      <td>...</td>
      <td>0.015868</td>
      <td>0.000653</td>
      <td>0.003944</td>
      <td>0.011636</td>
      <td>0.030150</td>
      <td>0.016665</td>
      <td>0.004634</td>
      <td>0.008585</td>
      <td>0.006081</td>
      <td>0.036379</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>0.107954</td>
      <td>0.010104</td>
      <td>0.000564</td>
      <td>0.001093</td>
      <td>0.027555</td>
      <td>0.125917</td>
      <td>0.111924</td>
      <td>0.004942</td>
      <td>0.003630</td>
      <td>0.046254</td>
      <td>...</td>
      <td>0.015999</td>
      <td>0.000653</td>
      <td>0.003976</td>
      <td>0.011727</td>
      <td>0.030150</td>
      <td>0.016687</td>
      <td>0.004626</td>
      <td>0.008435</td>
      <td>0.006079</td>
      <td>0.036373</td>
    </tr>
    <tr>
      <th>3.0</th>
      <td>0.110575</td>
      <td>0.010110</td>
      <td>0.000564</td>
      <td>0.001093</td>
      <td>0.028627</td>
      <td>0.125917</td>
      <td>0.111895</td>
      <td>0.004947</td>
      <td>0.003630</td>
      <td>0.046306</td>
      <td>...</td>
      <td>0.016125</td>
      <td>0.000653</td>
      <td>0.004017</td>
      <td>0.011795</td>
      <td>0.030150</td>
      <td>0.016703</td>
      <td>0.004616</td>
      <td>0.008353</td>
      <td>0.006077</td>
      <td>0.036378</td>
    </tr>
    <tr>
      <th>4.0</th>
      <td>0.112957</td>
      <td>0.010117</td>
      <td>0.000564</td>
      <td>0.001093</td>
      <td>0.029633</td>
      <td>0.125917</td>
      <td>0.111872</td>
      <td>0.004952</td>
      <td>0.003630</td>
      <td>0.046364</td>
      <td>...</td>
      <td>0.016263</td>
      <td>0.000653</td>
      <td>0.004060</td>
      <td>0.011858</td>
      <td>0.030150</td>
      <td>0.016720</td>
      <td>0.004606</td>
      <td>0.008309</td>
      <td>0.006075</td>
      <td>0.036393</td>
    </tr>
    <tr>
      <th>5.0</th>
      <td>0.115460</td>
      <td>0.010125</td>
      <td>0.000564</td>
      <td>0.001093</td>
      <td>0.030625</td>
      <td>0.125917</td>
      <td>0.111851</td>
      <td>0.004957</td>
      <td>0.003630</td>
      <td>0.046434</td>
      <td>...</td>
      <td>0.016427</td>
      <td>0.000653</td>
      <td>0.004105</td>
      <td>0.011927</td>
      <td>0.030150</td>
      <td>0.016741</td>
      <td>0.004598</td>
      <td>0.008297</td>
      <td>0.006072</td>
      <td>0.036419</td>
    </tr>
    <tr>
      <th>6.0</th>
      <td>0.118505</td>
      <td>0.010138</td>
      <td>0.000564</td>
      <td>0.001093</td>
      <td>0.031655</td>
      <td>0.125917</td>
      <td>0.111830</td>
      <td>0.004962</td>
      <td>0.003630</td>
      <td>0.046530</td>
      <td>...</td>
      <td>0.016638</td>
      <td>0.000653</td>
      <td>0.004150</td>
      <td>0.012011</td>
      <td>0.030150</td>
      <td>0.016773</td>
      <td>0.004591</td>
      <td>0.008324</td>
      <td>0.006070</td>
      <td>0.036465</td>
    </tr>
    <tr>
      <th>7.0</th>
      <td>0.123112</td>
      <td>0.010161</td>
      <td>0.000564</td>
      <td>0.001093</td>
      <td>0.032694</td>
      <td>0.125917</td>
      <td>0.111804</td>
      <td>0.004966</td>
      <td>0.003630</td>
      <td>0.046688</td>
      <td>...</td>
      <td>0.016966</td>
      <td>0.000653</td>
      <td>0.004197</td>
      <td>0.012141</td>
      <td>0.030150</td>
      <td>0.016836</td>
      <td>0.004588</td>
      <td>0.008426</td>
      <td>0.006067</td>
      <td>0.036559</td>
    </tr>
    <tr>
      <th>8.0</th>
      <td>0.133734</td>
      <td>0.011645</td>
      <td>0.000340</td>
      <td>0.000870</td>
      <td>0.033575</td>
      <td>0.129235</td>
      <td>0.108779</td>
      <td>0.004688</td>
      <td>0.003063</td>
      <td>0.052367</td>
      <td>...</td>
      <td>0.018224</td>
      <td>0.001059</td>
      <td>0.004159</td>
      <td>0.016334</td>
      <td>0.035428</td>
      <td>0.018678</td>
      <td>0.003592</td>
      <td>0.009150</td>
      <td>0.006692</td>
      <td>0.042688</td>
    </tr>
    <tr>
      <th>9.0</th>
      <td>0.123435</td>
      <td>0.010154</td>
      <td>0.000564</td>
      <td>0.001093</td>
      <td>0.033030</td>
      <td>0.125917</td>
      <td>0.111790</td>
      <td>0.004976</td>
      <td>0.003630</td>
      <td>0.046701</td>
      <td>...</td>
      <td>0.017093</td>
      <td>0.000653</td>
      <td>0.004302</td>
      <td>0.012159</td>
      <td>0.030150</td>
      <td>0.016790</td>
      <td>0.004592</td>
      <td>0.008234</td>
      <td>0.006062</td>
      <td>0.036497</td>
    </tr>
    <tr>
      <th>10.0</th>
      <td>0.119160</td>
      <td>0.010124</td>
      <td>0.000564</td>
      <td>0.001093</td>
      <td>0.032334</td>
      <td>0.125917</td>
      <td>0.111801</td>
      <td>0.004981</td>
      <td>0.003630</td>
      <td>0.046557</td>
      <td>...</td>
      <td>0.016899</td>
      <td>0.000653</td>
      <td>0.004362</td>
      <td>0.012048</td>
      <td>0.030150</td>
      <td>0.016679</td>
      <td>0.004598</td>
      <td>0.007934</td>
      <td>0.006060</td>
      <td>0.036339</td>
    </tr>
    <tr>
      <th>11.0</th>
      <td>0.116464</td>
      <td>0.010103</td>
      <td>0.000564</td>
      <td>0.001093</td>
      <td>0.031667</td>
      <td>0.125917</td>
      <td>0.111808</td>
      <td>0.004986</td>
      <td>0.003630</td>
      <td>0.046478</td>
      <td>...</td>
      <td>0.016835</td>
      <td>0.000653</td>
      <td>0.004425</td>
      <td>0.011984</td>
      <td>0.030150</td>
      <td>0.016595</td>
      <td>0.004602</td>
      <td>0.007689</td>
      <td>0.006057</td>
      <td>0.036223</td>
    </tr>
    <tr>
      <th>12.0</th>
      <td>0.114334</td>
      <td>0.010085</td>
      <td>0.000564</td>
      <td>0.001093</td>
      <td>0.031067</td>
      <td>0.125917</td>
      <td>0.111815</td>
      <td>0.004991</td>
      <td>0.003630</td>
      <td>0.046428</td>
      <td>...</td>
      <td>0.016847</td>
      <td>0.000653</td>
      <td>0.004486</td>
      <td>0.011937</td>
      <td>0.030150</td>
      <td>0.016514</td>
      <td>0.004603</td>
      <td>0.007452</td>
      <td>0.006054</td>
      <td>0.036115</td>
    </tr>
    <tr>
      <th>13.0</th>
      <td>0.112345</td>
      <td>0.010067</td>
      <td>0.000564</td>
      <td>0.001093</td>
      <td>0.030503</td>
      <td>0.125917</td>
      <td>0.111825</td>
      <td>0.004997</td>
      <td>0.003630</td>
      <td>0.046399</td>
      <td>...</td>
      <td>0.016938</td>
      <td>0.000653</td>
      <td>0.004540</td>
      <td>0.011898</td>
      <td>0.030150</td>
      <td>0.016423</td>
      <td>0.004597</td>
      <td>0.007184</td>
      <td>0.006051</td>
      <td>0.035997</td>
    </tr>
    <tr>
      <th>14.0</th>
      <td>0.110036</td>
      <td>0.010043</td>
      <td>0.000564</td>
      <td>0.001093</td>
      <td>0.029966</td>
      <td>0.125917</td>
      <td>0.111846</td>
      <td>0.005002</td>
      <td>0.003630</td>
      <td>0.046398</td>
      <td>...</td>
      <td>0.017176</td>
      <td>0.000653</td>
      <td>0.004575</td>
      <td>0.011857</td>
      <td>0.030150</td>
      <td>0.016293</td>
      <td>0.004580</td>
      <td>0.006819</td>
      <td>0.006048</td>
      <td>0.035833</td>
    </tr>
  </tbody>
</table>
<p>15 rows × 21 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">imputed_MT_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;MT_metabolite_imputed_data.csv&#39;</span><span class="p">)</span>
<span class="n">imputed_MT_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">imputed_MT_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>01_Fermentation</th>
      <th>02_Homoacetogenesis</th>
      <th>03_Superpathway of thiosulfate metabolism (Desulfovibrio sulfodismutans)</th>
      <th>04_Utililization of sugar, conversion of pentose to EMP pathway intermediates</th>
      <th>05_Fatty acid oxidation</th>
      <th>06_Amino acid utilization biosynthesis metabolism</th>
      <th>07_Nucleic acid metabolism</th>
      <th>08_Hydrocarbon degradation</th>
      <th>09_Carbohydrate Active enzyme - CAZy</th>
      <th>10_TCA cycle</th>
      <th>...</th>
      <th>12_Transporters</th>
      <th>13_Hydrogen metabolism</th>
      <th>14_Methanogenesis</th>
      <th>15_Methylotrophy</th>
      <th>16_Embden Meyerhof-Parnos (EMP)</th>
      <th>17_Gluconeogenesis</th>
      <th>18_Sulfur compounds metabolism</th>
      <th>19_Saccharide and derivated synthesis</th>
      <th>20_Hydrolysis of polymers</th>
      <th>21_Cellular response to stress</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.0</th>
      <td>0.032555</td>
      <td>0.004332</td>
      <td>6.551075e-04</td>
      <td>0.000551</td>
      <td>0.007245</td>
      <td>0.050208</td>
      <td>0.018190</td>
      <td>0.001434</td>
      <td>0.007091</td>
      <td>0.007711</td>
      <td>...</td>
      <td>0.013046</td>
      <td>7.636352e-04</td>
      <td>0.001359</td>
      <td>0.003455</td>
      <td>0.009246</td>
      <td>0.004036</td>
      <td>0.002204</td>
      <td>0.015901</td>
      <td>0.007996</td>
      <td>0.044404</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>0.032376</td>
      <td>0.004261</td>
      <td>1.417759e-20</td>
      <td>0.000649</td>
      <td>0.007283</td>
      <td>0.047614</td>
      <td>0.018241</td>
      <td>0.001163</td>
      <td>0.007493</td>
      <td>0.007491</td>
      <td>...</td>
      <td>0.012228</td>
      <td>1.703635e-19</td>
      <td>0.001268</td>
      <td>0.002820</td>
      <td>0.008107</td>
      <td>0.003502</td>
      <td>0.002264</td>
      <td>0.016145</td>
      <td>0.007861</td>
      <td>0.044433</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>0.032329</td>
      <td>0.004261</td>
      <td>1.417756e-20</td>
      <td>0.000649</td>
      <td>0.007282</td>
      <td>0.047304</td>
      <td>0.018290</td>
      <td>0.001163</td>
      <td>0.007542</td>
      <td>0.007490</td>
      <td>...</td>
      <td>0.012153</td>
      <td>1.703597e-19</td>
      <td>0.001268</td>
      <td>0.002820</td>
      <td>0.008107</td>
      <td>0.003502</td>
      <td>0.002264</td>
      <td>0.016171</td>
      <td>0.007860</td>
      <td>0.044494</td>
    </tr>
    <tr>
      <th>3.0</th>
      <td>0.032282</td>
      <td>0.004261</td>
      <td>1.417798e-20</td>
      <td>0.000649</td>
      <td>0.007282</td>
      <td>0.047108</td>
      <td>0.018347</td>
      <td>0.001163</td>
      <td>0.007596</td>
      <td>0.007489</td>
      <td>...</td>
      <td>0.012072</td>
      <td>1.703636e-19</td>
      <td>0.001268</td>
      <td>0.002820</td>
      <td>0.008107</td>
      <td>0.003502</td>
      <td>0.002264</td>
      <td>0.016193</td>
      <td>0.007859</td>
      <td>0.044560</td>
    </tr>
    <tr>
      <th>4.0</th>
      <td>0.032235</td>
      <td>0.004261</td>
      <td>1.417867e-20</td>
      <td>0.000649</td>
      <td>0.007282</td>
      <td>0.046958</td>
      <td>0.018413</td>
      <td>0.001163</td>
      <td>0.007650</td>
      <td>0.007488</td>
      <td>...</td>
      <td>0.011985</td>
      <td>1.703717e-19</td>
      <td>0.001268</td>
      <td>0.002820</td>
      <td>0.008107</td>
      <td>0.003502</td>
      <td>0.002264</td>
      <td>0.016214</td>
      <td>0.007858</td>
      <td>0.044633</td>
    </tr>
    <tr>
      <th>5.0</th>
      <td>0.032187</td>
      <td>0.004261</td>
      <td>1.417960e-20</td>
      <td>0.000649</td>
      <td>0.007282</td>
      <td>0.046824</td>
      <td>0.018489</td>
      <td>0.001163</td>
      <td>0.007695</td>
      <td>0.007487</td>
      <td>...</td>
      <td>0.011894</td>
      <td>1.703833e-19</td>
      <td>0.001268</td>
      <td>0.002820</td>
      <td>0.008107</td>
      <td>0.003502</td>
      <td>0.002264</td>
      <td>0.016235</td>
      <td>0.007857</td>
      <td>0.044712</td>
    </tr>
    <tr>
      <th>6.0</th>
      <td>0.032140</td>
      <td>0.004261</td>
      <td>1.418084e-20</td>
      <td>0.000649</td>
      <td>0.007282</td>
      <td>0.046689</td>
      <td>0.018577</td>
      <td>0.001163</td>
      <td>0.007726</td>
      <td>0.007485</td>
      <td>...</td>
      <td>0.011798</td>
      <td>1.703990e-19</td>
      <td>0.001268</td>
      <td>0.002820</td>
      <td>0.008107</td>
      <td>0.003502</td>
      <td>0.002264</td>
      <td>0.016256</td>
      <td>0.007856</td>
      <td>0.044790</td>
    </tr>
    <tr>
      <th>7.0</th>
      <td>0.032093</td>
      <td>0.004261</td>
      <td>1.418264e-20</td>
      <td>0.000649</td>
      <td>0.007282</td>
      <td>0.046514</td>
      <td>0.018671</td>
      <td>0.001163</td>
      <td>0.007735</td>
      <td>0.007484</td>
      <td>...</td>
      <td>0.011699</td>
      <td>1.704220e-19</td>
      <td>0.001268</td>
      <td>0.002820</td>
      <td>0.008107</td>
      <td>0.003502</td>
      <td>0.002264</td>
      <td>0.016273</td>
      <td>0.007854</td>
      <td>0.044850</td>
    </tr>
    <tr>
      <th>8.0</th>
      <td>0.032122</td>
      <td>0.004362</td>
      <td>8.355870e-04</td>
      <td>0.000600</td>
      <td>0.007049</td>
      <td>0.045215</td>
      <td>0.019025</td>
      <td>0.001449</td>
      <td>0.008429</td>
      <td>0.007428</td>
      <td>...</td>
      <td>0.011506</td>
      <td>6.943123e-04</td>
      <td>0.001097</td>
      <td>0.003125</td>
      <td>0.009361</td>
      <td>0.003913</td>
      <td>0.002097</td>
      <td>0.015956</td>
      <td>0.008593</td>
      <td>0.045070</td>
    </tr>
    <tr>
      <th>9.0</th>
      <td>0.031966</td>
      <td>0.004261</td>
      <td>1.418395e-20</td>
      <td>0.000649</td>
      <td>0.007283</td>
      <td>0.046505</td>
      <td>0.018789</td>
      <td>0.001163</td>
      <td>0.007679</td>
      <td>0.007480</td>
      <td>...</td>
      <td>0.011494</td>
      <td>1.704403e-19</td>
      <td>0.001268</td>
      <td>0.002820</td>
      <td>0.008107</td>
      <td>0.003502</td>
      <td>0.002264</td>
      <td>0.016354</td>
      <td>0.007850</td>
      <td>0.044836</td>
    </tr>
    <tr>
      <th>10.0</th>
      <td>0.031887</td>
      <td>0.004261</td>
      <td>1.418347e-20</td>
      <td>0.000649</td>
      <td>0.007284</td>
      <td>0.046678</td>
      <td>0.018818</td>
      <td>0.001163</td>
      <td>0.007616</td>
      <td>0.007478</td>
      <td>...</td>
      <td>0.011390</td>
      <td>1.704356e-19</td>
      <td>0.001268</td>
      <td>0.002820</td>
      <td>0.008107</td>
      <td>0.003502</td>
      <td>0.002264</td>
      <td>0.016421</td>
      <td>0.007848</td>
      <td>0.044762</td>
    </tr>
    <tr>
      <th>11.0</th>
      <td>0.031808</td>
      <td>0.004261</td>
      <td>1.418359e-20</td>
      <td>0.000649</td>
      <td>0.007284</td>
      <td>0.046822</td>
      <td>0.018866</td>
      <td>0.001163</td>
      <td>0.007537</td>
      <td>0.007476</td>
      <td>...</td>
      <td>0.011286</td>
      <td>1.704385e-19</td>
      <td>0.001268</td>
      <td>0.002820</td>
      <td>0.008107</td>
      <td>0.003502</td>
      <td>0.002264</td>
      <td>0.016494</td>
      <td>0.007846</td>
      <td>0.044671</td>
    </tr>
    <tr>
      <th>12.0</th>
      <td>0.031729</td>
      <td>0.004261</td>
      <td>1.418405e-20</td>
      <td>0.000649</td>
      <td>0.007286</td>
      <td>0.046989</td>
      <td>0.018941</td>
      <td>0.001163</td>
      <td>0.007454</td>
      <td>0.007474</td>
      <td>...</td>
      <td>0.011183</td>
      <td>1.704460e-19</td>
      <td>0.001268</td>
      <td>0.002820</td>
      <td>0.008107</td>
      <td>0.003502</td>
      <td>0.002264</td>
      <td>0.016584</td>
      <td>0.007844</td>
      <td>0.044574</td>
    </tr>
    <tr>
      <th>13.0</th>
      <td>0.031650</td>
      <td>0.004261</td>
      <td>1.418484e-20</td>
      <td>0.000649</td>
      <td>0.007287</td>
      <td>0.047226</td>
      <td>0.019043</td>
      <td>0.001163</td>
      <td>0.007376</td>
      <td>0.007472</td>
      <td>...</td>
      <td>0.011082</td>
      <td>1.704580e-19</td>
      <td>0.001268</td>
      <td>0.002820</td>
      <td>0.008107</td>
      <td>0.003502</td>
      <td>0.002264</td>
      <td>0.016709</td>
      <td>0.007841</td>
      <td>0.044473</td>
    </tr>
    <tr>
      <th>14.0</th>
      <td>0.031571</td>
      <td>0.004261</td>
      <td>1.418615e-20</td>
      <td>0.000649</td>
      <td>0.007288</td>
      <td>0.047657</td>
      <td>0.019140</td>
      <td>0.001163</td>
      <td>0.007313</td>
      <td>0.007470</td>
      <td>...</td>
      <td>0.010982</td>
      <td>1.704772e-19</td>
      <td>0.001268</td>
      <td>0.002820</td>
      <td>0.008107</td>
      <td>0.003502</td>
      <td>0.002264</td>
      <td>0.016922</td>
      <td>0.007838</td>
      <td>0.044353</td>
    </tr>
  </tbody>
</table>
<p>15 rows × 21 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tsa.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">VAR</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make VAR model with the imputed data set and statsmodels library</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">VAR</span><span class="p">(</span><span class="n">imputed_data</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">maxlags</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ml&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
c:\ProgramData\anaconda3\envs\MIMIC\Lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: An unsupported index was provided and will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coefficients</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span>
<span class="n">covariance_matrix</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">sigma_u</span>
<span class="n">intercepts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># remove the first row of the coefficients matrix</span>
<span class="n">coefficients</span> <span class="o">=</span> <span class="n">coefficients</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="c1"># transpose the coefficients matrix</span>
<span class="n">coefficients</span> <span class="o">=</span> <span class="n">coefficients</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">coefficients</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                       L1.Acidimicrobium  L1.Acinetobacter  L1.Albidiferax  \
Acidimicrobium                  0.963205         -0.004673       -0.033426
Acinetobacter                  -0.116193          0.909450       -0.122479
Albidiferax                     0.036651         -0.005288        1.025312
Candidatus Microthrix          -0.075924         -0.049265       -0.105313
Chitinophaga pinensis          -0.115842         -0.047209        0.075176
Dechloromonas                   0.014449         -0.000909        0.004961
Haliscomenobacter              -0.007802         -0.004379       -0.045865
Intrasporangium                 0.039053          0.026513        0.021795
Leptospira                      0.165565          0.043335       -0.005578
Other                           0.014019          0.005023        0.029675
Xanthomonas                    -0.027268         -0.002598        0.014894
mean abundance &lt; 2%            -0.010830          0.006473        0.067992

                       L1.Candidatus Microthrix  L1.Chitinophaga pinensis  \
Acidimicrobium                        -0.007765                 -0.003890
Acinetobacter                         -0.053319                 -0.055020
Albidiferax                           -0.010315                 -0.017732
Candidatus Microthrix                  0.945760                 -0.062214
Chitinophaga pinensis                 -0.032266                  0.916255
Dechloromonas                         -0.001062                 -0.000513
Haliscomenobacter                     -0.017300                  0.005880
Intrasporangium                        0.009746                  0.018528
Leptospira                             0.028434                  0.080814
Other                                  0.005560                  0.001574
Xanthomonas                            0.000006                 -0.007796
mean abundance &lt; 2%                    0.007459                  0.002828

                       L1.Dechloromonas  L1.Haliscomenobacter  \
Acidimicrobium                -0.028836             -0.000381
Acinetobacter                 -0.120288             -0.065033
Albidiferax                   -0.010525             -0.007213
Candidatus Microthrix         -0.092386             -0.031745
Chitinophaga pinensis         -0.024099             -0.064282
Dechloromonas                  1.008220             -0.002000
Haliscomenobacter              0.027866              0.972498
Intrasporangium                0.062233              0.011920
Leptospira                     0.040301              0.083109
Other                         -0.006532              0.006801
Xanthomonas                   -0.022118              0.001205
mean abundance &lt; 2%            0.015356             -0.002470

                       L1.Intrasporangium  L1.Leptospira  L1.Other  \
Acidimicrobium                   0.003852      -0.018886 -0.071549
Acinetobacter                   -0.169053      -0.028418  0.082148
Albidiferax                     -0.009145       0.000898 -0.114294
Candidatus Microthrix            0.028549      -0.072750 -0.124845
Chitinophaga pinensis           -0.006870      -0.049551 -0.042289
Dechloromonas                    0.000399       0.001850  0.017999
Haliscomenobacter                0.001219      -0.028812  0.027804
Intrasporangium                  1.013150      -0.001406  0.032484
Leptospira                      -0.013502       1.039789  0.115065
Other                            0.001661       0.010241  0.980034
Xanthomonas                     -0.000700       0.000163 -0.023899
mean abundance &lt; 2%              0.019977       0.026820 -0.100714

                       L1.Xanthomonas  L1.mean abundance &lt; 2%
Acidimicrobium               0.053300               -0.003768
Acinetobacter               -0.351822               -0.037516
Albidiferax                  0.010249               -0.012573
Candidatus Microthrix        0.207496               -0.046151
Chitinophaga pinensis        0.168200               -0.053289
Dechloromonas                0.016044               -0.008142
Haliscomenobacter           -0.088561                0.000027
Intrasporangium              0.056446               -0.010126
Leptospira                  -0.055608               -0.013448
Other                        0.007062                0.004578
Xanthomonas                  0.994634                0.006090
mean abundance &lt; 2%          0.019977                1.019772
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">normalVAR</span> <span class="o">=</span> <span class="n">infer_VAR</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">imputed_data</span><span class="p">)</span>
<span class="n">normalVAR</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="s1">&#39;high&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">normalVAR</span><span class="o">.</span><span class="n">run_inference</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (2 chains in 2 jobs)
NUTS: [x0, A, noise_chol]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
    <style>
        /* Turns off some styling */
        progress {
            /* gets rid of default border in Firefox and Opera. */
            border: none;
            /* Needs to be in here for Safari polyfill so background images work as expected. */
            background-size: auto;
        }
        .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
            background: #F44336;
        }
    </style>
  <progress value='6000' class='' max='6000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [6000/6000 19:48<00:00 Sampling 2 chains, 0 divergences]
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 2 chains for 1_000 tune and 2_000 draw iterations (2_000 + 4_000 draws total) took 1192 seconds.
We recommend running at least 4 chains for robust computation of convergence diagnostics
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
            mean     sd  hdi_3%  hdi_97%  mcse_mean  mcse_sd  ess_bulk  \
x0[0]      0.535  0.499  -0.364    1.493      0.016    0.012     922.0
x0[1]      1.576  0.941  -0.172    3.329      0.023    0.017    1632.0
x0[2]     -0.098  0.438  -0.867    0.753      0.016    0.011     755.0
x0[3]      1.589  0.890  -0.029    3.303      0.022    0.016    1618.0
x0[4]      2.443  0.760   0.998    3.833      0.024    0.017     988.0
...          ...    ...     ...      ...        ...      ...       ...
A[11, 7]   0.014  0.007  -0.000    0.027      0.000    0.000    1101.0
A[11, 8]   0.021  0.006   0.009    0.032      0.000    0.000    1020.0
A[11, 9]  -0.111  0.023  -0.150   -0.066      0.000    0.000    2425.0
A[11, 10]  0.018  0.021  -0.021    0.058      0.000    0.000    2410.0
A[11, 11]  1.013  0.010   0.994    1.031      0.000    0.000    1281.0

           ess_tail  r_hat
x0[0]        1481.0    1.0
x0[1]        2190.0    1.0
x0[2]        1476.0    1.0
x0[3]        1917.0    1.0
x0[4]        1497.0    1.0
...             ...    ...
A[11, 7]     2244.0    1.0
A[11, 8]     1810.0    1.0
A[11, 9]     2834.0    1.0
A[11, 10]    2720.0    1.0
A[11, 11]    2099.0    1.0

[156 rows x 9 columns]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
c:\ProgramData\anaconda3\envs\MIMIC\Lib\site-packages\arviz\plots\plot_utils.py:271: UserWarning: rcParams[&#39;plot.max_subplots&#39;] (40) is smaller than the number of variables to plot (156) in plot_posterior, generating only 40 plots
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Results saved as:
NetCDF file: model_posterior_default_v1.nc
Data file: data_default_v1.npz
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_MultiModel_Herold_examples-Herold-sVAR_13_6.png" src="../../../_images/notebooks_MultiModel_Herold_examples-Herold-sVAR_13_6.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">posteriorVAR</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">from_netcdf</span><span class="p">(</span><span class="s1">&#39;model_posterior_default.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coefficients</span> <span class="o">=</span> <span class="n">posteriorVAR</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">coefficients_median</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">coefficients</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<span class="n">intercepts</span> <span class="o">=</span> <span class="n">posteriorVAR</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">intercepts_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">intercepts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>So, these inferences show that there is no easy correlation to infer between the species relative abundances and the metabolite concentrations. This could be due to us trying to infer the causal inference between the relative abundance, and not the change in relative abundance of the species. In the next step, we will try to infer the causal relationships between the change in relative abundance of the species and the metabolite concentrations.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s calculate the change in relative abundance for each genus over time from the imputed_data dataset</span>

<span class="c1"># Calculate the change in relative abundance for each genus</span>
<span class="n">data_change</span> <span class="o">=</span> <span class="n">imputed_data</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>

<span class="c1"># Make the first row as 0.0 replacing NaN</span>
<span class="n">data_change</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tsa.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">VAR</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make VAR model with the imputed data set and statsmodels library</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">VAR</span><span class="p">(</span><span class="n">data_change</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">maxlags</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ml&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
c:\ProgramData\anaconda3\envs\MIMIC\Lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: An unsupported index was provided and will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coefficients</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span>
<span class="n">covariance_matrix</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">sigma_u</span>
<span class="n">intercepts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># remove the first row of the coefficients matrix</span>
<span class="n">coefficients</span> <span class="o">=</span> <span class="n">coefficients</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="c1"># transpose the coefficients matrix</span>
<span class="n">coefficients</span> <span class="o">=</span> <span class="n">coefficients</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inferChageWithPrior</span> <span class="o">=</span> <span class="n">infer_VAR</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_change</span><span class="p">,</span> <span class="n">dataS</span><span class="o">=</span><span class="n">imputed_MP_data</span><span class="p">,</span>
                                <span class="n">coefficients</span><span class="o">=</span><span class="n">coefficients</span><span class="p">,</span> <span class="n">intercepts</span><span class="o">=</span><span class="n">intercepts</span><span class="p">)</span>
<span class="n">inferChageWithPrior</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="s1">&#39;high&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inferChageWithPrior</span><span class="o">.</span><span class="n">run_inference</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;xs&#39;</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (2 chains in 2 jobs)
NUTS: [X0h, S0h, Ah, Bh, sigma]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
    <style>
        /* Turns off some styling */
        progress {
            /* gets rid of default border in Firefox and Opera. */
            border: none;
            /* Needs to be in here for Safari polyfill so background images work as expected. */
            background-size: auto;
        }
        .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
            background: #F44336;
        }
    </style>
  <progress value='14000' class='' max='14000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [14000/14000 54:03<00:00 Sampling 2 chains, 2,000 divergences]
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 2 chains for 5_000 tune and 2_000 draw iterations (10_000 + 4_000 draws total) took 3247 seconds.
We recommend running at least 4 chains for robust computation of convergence diagnostics
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
             mean     sd  hdi_3%  hdi_97%  mcse_mean  mcse_sd  ess_bulk  \
Ah[0, 0]    0.478  0.420   0.058    0.925      0.296    0.251       3.0
Ah[0, 1]    0.008  0.004   0.002    0.016      0.001    0.001      21.0
Ah[0, 2]   -0.191  0.106  -0.297   -0.057      0.074    0.063       3.0
Ah[0, 3]    0.014  0.011   0.005    0.035      0.007    0.005       3.0
Ah[0, 4]   -0.051  0.071  -0.122    0.031      0.050    0.042       3.0
...           ...    ...     ...      ...        ...      ...       ...
Bh[20, 7]   0.179  0.143  -0.164    0.397      0.037    0.027      17.0
Bh[20, 8]  -0.001  0.161  -0.122    0.394      0.095    0.076       3.0
Bh[20, 9]  -0.193  0.657  -1.467    1.257      0.115    0.114      32.0
Bh[20, 10] -0.243  0.404  -0.591    0.515      0.241    0.193       3.0
Bh[20, 11]  0.218  0.177  -0.243    0.501      0.082    0.062       5.0

            ess_tail  r_hat
Ah[0, 0]        32.0   1.94
Ah[0, 1]        31.0   1.87
Ah[0, 2]        41.0   1.84
Ah[0, 3]        21.0   1.90
Ah[0, 4]        21.0   2.06
...              ...    ...
Bh[20, 7]       38.0   1.93
Bh[20, 8]       16.0   2.27
Bh[20, 9]       87.0   1.78
Bh[20, 10]      20.0   2.19
Bh[20, 11]      14.0   1.86

[396 rows x 9 columns]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
c:\ProgramData\anaconda3\envs\MIMIC\Lib\site-packages\arviz\plots\plot_utils.py:271: UserWarning: rcParams[&#39;plot.max_subplots&#39;] (40) is smaller than the number of variables to plot (396) in plot_posterior, generating only 40 plots
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Results saved as:
NetCDF file: model_posterior_xs_v1.nc
Data file: data_xs_v1.npz
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_MultiModel_Herold_examples-Herold-sVAR_22_6.png" src="../../../_images/notebooks_MultiModel_Herold_examples-Herold-sVAR_22_6.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inferChageWithPrior</span><span class="o">.</span><span class="n">posterior_analysis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_MultiModel_Herold_examples-Herold-sVAR_23_0.png" src="../../../_images/notebooks_MultiModel_Herold_examples-Herold-sVAR_23_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_MultiModel_Herold_examples-Herold-sVAR_23_1.png" src="../../../_images/notebooks_MultiModel_Herold_examples-Herold-sVAR_23_1.png" />
</div>
</div>
<p>We can also increase the increase the burn-in and number of samples to get more accurate results.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inferChageWithPrior2</span> <span class="o">=</span> <span class="n">infer_VAR</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_change</span><span class="p">,</span> <span class="n">dataS</span><span class="o">=</span><span class="n">imputed_MP_data</span><span class="p">,</span>
                                 <span class="n">coefficients</span><span class="o">=</span><span class="n">coefficients</span><span class="p">,</span> <span class="n">intercepts</span><span class="o">=</span><span class="n">intercepts</span><span class="p">)</span>
<span class="n">inferChageWithPrior2</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="s1">&#39;high&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inferChageWithPrior2</span><span class="o">.</span><span class="n">run_inference</span><span class="p">(</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;xs&#39;</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [X0h, S0h, Ah, Bh, sigma]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
    <style>
        /* Turns off some styling */
        progress {
            /* gets rid of default border in Firefox and Opera. */
            border: none;
            /* Needs to be in here for Safari polyfill so background images work as expected. */
            background-size: auto;
        }
        .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
            background: #F44336;
        }
    </style>
  <progress value='48000' class='' max='48000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [48000/48000 2:18:51<00:00 Sampling 4 chains, 4,010 divergences]
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 4 chains for 8_000 tune and 4_000 draw iterations (32_000 + 16_000 draws total) took 8338 seconds.
The rhat statistic is larger than 1.01 for some parameters. This indicates problems during sampling. See https://arxiv.org/abs/1903.08008 for details
The effective sample size per chain is smaller than 100 for some parameters.  A higher number is needed for reliable rhat and ess computation. See https://arxiv.org/abs/1903.08008 for details
There were 4010 divergences after tuning. Increase `target_accept` or reparameterize.
Chain 0 reached the maximum tree depth. Increase `max_treedepth`, increase `target_accept` or reparameterize.
Chain 1 reached the maximum tree depth. Increase `max_treedepth`, increase `target_accept` or reparameterize.
Chain 2 reached the maximum tree depth. Increase `max_treedepth`, increase `target_accept` or reparameterize.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
             mean     sd  hdi_3%  hdi_97%  mcse_mean  mcse_sd  ess_bulk  \
Ah[0, 0]    0.902  0.019   0.862    0.935      0.002    0.001     199.0
Ah[0, 1]    0.009  0.004   0.002    0.019      0.001    0.000      73.0
Ah[0, 2]   -0.081  0.022  -0.127   -0.047      0.005    0.003      27.0
Ah[0, 3]    0.022  0.007   0.010    0.036      0.001    0.001      52.0
Ah[0, 4]    0.017  0.009   0.002    0.036      0.002    0.001      30.0
...           ...    ...     ...      ...        ...      ...       ...
Bh[20, 7]  -0.022  0.313  -0.515    0.656      0.101    0.074       9.0
Bh[20, 8]   0.063  0.207  -0.400    0.356      0.061    0.044      16.0
Bh[20, 9]  -0.181  0.947  -1.586    1.841      0.207    0.148      24.0
Bh[20, 10]  0.177  0.497  -0.878    0.885      0.125    0.090      15.0
Bh[20, 11]  0.174  0.448  -0.539    0.766      0.181    0.136       6.0

            ess_tail  r_hat
Ah[0, 0]       622.0   1.39
Ah[0, 1]       272.0   1.16
Ah[0, 2]       596.0   1.12
Ah[0, 3]       188.0   1.23
Ah[0, 4]       419.0   1.10
...              ...    ...
Bh[20, 7]       22.0   1.36
Bh[20, 8]       23.0   1.20
Bh[20, 9]      530.0   1.12
Bh[20, 10]      92.0   1.26
Bh[20, 11]      13.0   1.69

[396 rows x 9 columns]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
c:\ProgramData\anaconda3\envs\MIMIC\Lib\site-packages\arviz\plots\plot_utils.py:271: UserWarning: rcParams[&#39;plot.max_subplots&#39;] (40) is smaller than the number of variables to plot (396) in plot_posterior, generating only 40 plots
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Results saved as:
NetCDF file: model_posterior_xs_v2.nc
Data file: data_xs_v2.npz
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_MultiModel_Herold_examples-Herold-sVAR_26_6.png" src="../../../_images/notebooks_MultiModel_Herold_examples-Herold-sVAR_26_6.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inferChageWithPrior2</span><span class="o">.</span><span class="n">posterior_analysis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_MultiModel_Herold_examples-Herold-sVAR_27_0.png" src="../../../_images/notebooks_MultiModel_Herold_examples-Herold-sVAR_27_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_MultiModel_Herold_examples-Herold-sVAR_27_1.png" src="../../../_images/notebooks_MultiModel_Herold_examples-Herold-sVAR_27_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now we are going to check for stationarity in the data using adf and kpss tests from stasmodels library</span>
<span class="c1"># We will use the imputed data set</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tsa.stattools</span><span class="w"> </span><span class="kn">import</span> <span class="n">adfuller</span><span class="p">,</span> <span class="n">kpss</span>


<span class="k">def</span><span class="w"> </span><span class="nf">adf_test</span><span class="p">(</span><span class="n">timeseries</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Results of Dickey-Fuller Test:&quot;</span><span class="p">)</span>
    <span class="n">dftest</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">timeseries</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s2">&quot;AIC&quot;</span><span class="p">)</span>
    <span class="n">dfoutput</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
        <span class="n">dftest</span><span class="p">[:</span><span class="mi">4</span><span class="p">],</span>
        <span class="n">index</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;Test Statistic&quot;</span><span class="p">,</span>
            <span class="s2">&quot;p-value&quot;</span><span class="p">,</span>
            <span class="s2">&quot;#Lags Used&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Number of Observations Used&quot;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">dfoutput</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Critical Value (</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dfoutput</span><span class="p">)</span>
    <span class="c1"># if p-value is less than 0.05, we reject the null hypothesis and say that the data is stationary</span>
    <span class="c1"># print if the data is stationary or not</span>
    <span class="k">if</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.05</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ADF Test: Data is stationary&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ADF Test: Data is not stationary&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">kpss_test</span><span class="p">(</span><span class="n">timeseries</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Results of KPSS Test:&quot;</span><span class="p">)</span>
    <span class="n">kpsstest</span> <span class="o">=</span> <span class="n">kpss</span><span class="p">(</span><span class="n">timeseries</span><span class="p">,</span> <span class="n">regression</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
    <span class="n">kpss_output</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
        <span class="n">kpsstest</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Test Statistic&quot;</span><span class="p">,</span> <span class="s2">&quot;p-value&quot;</span><span class="p">,</span> <span class="s2">&quot;Lags Used&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kpsstest</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">kpss_output</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Critical Value (</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">kpss_output</span><span class="p">)</span>
    <span class="c1"># if p-value is greater than 0.05, we reject the null hypothesis and say that the data is stationary</span>
    <span class="c1"># print if the data is stationary or not</span>
    <span class="k">if</span> <span class="n">kpsstest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.05</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;KPSS test: Data is stationary&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;KPSS test: Data is not stationary&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check for stationarity in the data imputed_dataset (without the &#39;days&#39; column)</span>
<span class="k">for</span> <span class="n">genus</span> <span class="ow">in</span> <span class="n">data_change</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">genus</span><span class="p">)</span>
    <span class="n">adf_test</span><span class="p">(</span><span class="n">data_change</span><span class="p">[</span><span class="n">genus</span><span class="p">])</span>
    <span class="n">kpss_test</span><span class="p">(</span><span class="n">data_change</span><span class="p">[</span><span class="n">genus</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Acidimicrobium
Results of Dickey-Fuller Test:
Test Statistic                  -4.877743
p-value                          0.000039
#Lags Used                      16.000000
Number of Observations Used    393.000000
Critical Value (1%)             -3.447099
Critical Value (5%)             -2.868923
Critical Value (10%)            -2.570703
dtype: float64
ADF Test: Data is stationary
Results of KPSS Test:
Test Statistic            0.032404
p-value                   0.100000
Lags Used                11.000000
Critical Value (10%)      0.347000
Critical Value (5%)       0.463000
Critical Value (2.5%)     0.574000
Critical Value (1%)       0.739000
dtype: float64
KPSS test: Data is stationary


Acinetobacter
Results of Dickey-Fuller Test:
Test Statistic                  -4.598946
p-value                          0.000130
#Lags Used                      17.000000
Number of Observations Used    392.000000
Critical Value (1%)             -3.447142
Critical Value (5%)             -2.868941
Critical Value (10%)            -2.570713
dtype: float64
ADF Test: Data is stationary
Results of KPSS Test:
Test Statistic            0.173686
p-value                   0.100000
Lags Used                10.000000
Critical Value (10%)      0.347000
Critical Value (5%)       0.463000
Critical Value (2.5%)     0.574000
Critical Value (1%)       0.739000
dtype: float64
KPSS test: Data is stationary


Albidiferax
Results of Dickey-Fuller Test:
Test Statistic                  -3.829655
p-value                          0.002618
#Lags Used                      11.000000
Number of Observations Used    398.000000
Critical Value (1%)             -3.446888
Critical Value (5%)             -2.868829
Critical Value (10%)            -2.570653
dtype: float64
ADF Test: Data is stationary
Results of KPSS Test:
Test Statistic            0.043204
p-value                   0.100000
Lags Used                11.000000
Critical Value (10%)      0.347000
Critical Value (5%)       0.463000
Critical Value (2.5%)     0.574000
Critical Value (1%)       0.739000
dtype: float64
KPSS test: Data is stationary


Candidatus Microthrix
Results of Dickey-Fuller Test:
Test Statistic                -7.937074e+00
p-value                        3.391025e-12
#Lags Used                     6.000000e+00
Number of Observations Used    4.030000e+02
Critical Value (1%)           -3.446681e+00
Critical Value (5%)           -2.868739e+00
Critical Value (10%)          -2.570605e+00
dtype: float64
ADF Test: Data is stationary
Results of KPSS Test:
Test Statistic            0.094575
p-value                   0.100000
Lags Used                11.000000
Critical Value (10%)      0.347000
Critical Value (5%)       0.463000
Critical Value (2.5%)     0.574000
Critical Value (1%)       0.739000
dtype: float64
KPSS test: Data is stationary


Chitinophaga pinensis
Results of Dickey-Fuller Test:
Test Statistic                  -3.816479
p-value                          0.002743
#Lags Used                      16.000000
Number of Observations Used    393.000000
Critical Value (1%)             -3.447099
Critical Value (5%)             -2.868923
Critical Value (10%)            -2.570703
dtype: float64
ADF Test: Data is stationary
Results of KPSS Test:
Test Statistic            0.059832
p-value                   0.100000
Lags Used                11.000000
Critical Value (10%)      0.347000
Critical Value (5%)       0.463000
Critical Value (2.5%)     0.574000
Critical Value (1%)       0.739000
dtype: float64
KPSS test: Data is stationary


Dechloromonas
Results of Dickey-Fuller Test:
Test Statistic                  -3.320016
p-value                          0.014007
#Lags Used                      15.000000
Number of Observations Used    394.000000
Critical Value (1%)             -3.447057
Critical Value (5%)             -2.868904
Critical Value (10%)            -2.570693
dtype: float64
ADF Test: Data is stationary
Results of KPSS Test:
Test Statistic            0.106131
p-value                   0.100000
Lags Used                11.000000
Critical Value (10%)      0.347000
Critical Value (5%)       0.463000
Critical Value (2.5%)     0.574000
Critical Value (1%)       0.739000
dtype: float64
KPSS test: Data is stationary


Haliscomenobacter
Results of Dickey-Fuller Test:
Test Statistic                  -3.790187
p-value                          0.003009
#Lags Used                      17.000000
Number of Observations Used    392.000000
Critical Value (1%)             -3.447142
Critical Value (5%)             -2.868941
Critical Value (10%)            -2.570713
dtype: float64
ADF Test: Data is stationary
Results of KPSS Test:
Test Statistic            0.099982
p-value                   0.100000
Lags Used                11.000000
Critical Value (10%)      0.347000
Critical Value (5%)       0.463000
Critical Value (2.5%)     0.574000
Critical Value (1%)       0.739000
dtype: float64
KPSS test: Data is stationary


Intrasporangium
Results of Dickey-Fuller Test:
Test Statistic                  -4.249279
p-value                          0.000543
#Lags Used                      18.000000
Number of Observations Used    391.000000
Critical Value (1%)             -3.447186
Critical Value (5%)             -2.868960
Critical Value (10%)            -2.570723
dtype: float64
ADF Test: Data is stationary
Results of KPSS Test:
Test Statistic            0.197429
p-value                   0.100000
Lags Used                11.000000
Critical Value (10%)      0.347000
Critical Value (5%)       0.463000
Critical Value (2.5%)     0.574000
Critical Value (1%)       0.739000
dtype: float64
KPSS test: Data is stationary


Leptospira
Results of Dickey-Fuller Test:
Test Statistic                  -3.825629
p-value                          0.002656
#Lags Used                      17.000000
Number of Observations Used    392.000000
Critical Value (1%)             -3.447142
Critical Value (5%)             -2.868941
Critical Value (10%)            -2.570713
dtype: float64
ADF Test: Data is stationary
Results of KPSS Test:
Test Statistic            0.039661
p-value                   0.100000
Lags Used                11.000000
Critical Value (10%)      0.347000
Critical Value (5%)       0.463000
Critical Value (2.5%)     0.574000
Critical Value (1%)       0.739000
dtype: float64
KPSS test: Data is stationary


Other
Results of Dickey-Fuller Test:
Test Statistic                -7.502466e+00
p-value                        4.218178e-11
#Lags Used                     6.000000e+00
Number of Observations Used    4.030000e+02
Critical Value (1%)           -3.446681e+00
Critical Value (5%)           -2.868739e+00
Critical Value (10%)          -2.570605e+00
dtype: float64
ADF Test: Data is stationary
Results of KPSS Test:
Test Statistic            0.075135
p-value                   0.100000
Lags Used                11.000000
Critical Value (10%)      0.347000
Critical Value (5%)       0.463000
Critical Value (2.5%)     0.574000
Critical Value (1%)       0.739000
dtype: float64
KPSS test: Data is stationary


Xanthomonas
Results of Dickey-Fuller Test:
Test Statistic                  -3.684859
p-value                          0.004331
#Lags Used                      18.000000
Number of Observations Used    391.000000
Critical Value (1%)             -3.447186
Critical Value (5%)             -2.868960
Critical Value (10%)            -2.570723
dtype: float64
ADF Test: Data is stationary
Results of KPSS Test:
Test Statistic            0.1455
p-value                   0.1000
Lags Used                11.0000
Critical Value (10%)      0.3470
Critical Value (5%)       0.4630
Critical Value (2.5%)     0.5740
Critical Value (1%)       0.7390
dtype: float64
KPSS test: Data is stationary


mean abundance &lt; 2%
Results of Dickey-Fuller Test:
Test Statistic                  -4.761013
p-value                          0.000065
#Lags Used                       7.000000
Number of Observations Used    402.000000
Critical Value (1%)             -3.446722
Critical Value (5%)             -2.868757
Critical Value (10%)            -2.570614
dtype: float64
ADF Test: Data is stationary
Results of KPSS Test:
Test Statistic            0.189282
p-value                   0.100000
Lags Used                11.000000
Critical Value (10%)      0.347000
Critical Value (5%)       0.463000
Critical Value (2.5%)     0.574000
Critical Value (1%)       0.739000
dtype: float64
KPSS test: Data is stationary


</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
C:\Users\User\AppData\Local\Temp\ipykernel_16772\3039934652.py:33: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  kpsstest = kpss(timeseries, regression=&#34;c&#34;, nlags=&#34;auto&#34;)
C:\Users\User\AppData\Local\Temp\ipykernel_16772\3039934652.py:33: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  kpsstest = kpss(timeseries, regression=&#34;c&#34;, nlags=&#34;auto&#34;)
C:\Users\User\AppData\Local\Temp\ipykernel_16772\3039934652.py:33: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  kpsstest = kpss(timeseries, regression=&#34;c&#34;, nlags=&#34;auto&#34;)
C:\Users\User\AppData\Local\Temp\ipykernel_16772\3039934652.py:33: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  kpsstest = kpss(timeseries, regression=&#34;c&#34;, nlags=&#34;auto&#34;)
C:\Users\User\AppData\Local\Temp\ipykernel_16772\3039934652.py:33: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  kpsstest = kpss(timeseries, regression=&#34;c&#34;, nlags=&#34;auto&#34;)
C:\Users\User\AppData\Local\Temp\ipykernel_16772\3039934652.py:33: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  kpsstest = kpss(timeseries, regression=&#34;c&#34;, nlags=&#34;auto&#34;)
C:\Users\User\AppData\Local\Temp\ipykernel_16772\3039934652.py:33: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  kpsstest = kpss(timeseries, regression=&#34;c&#34;, nlags=&#34;auto&#34;)
C:\Users\User\AppData\Local\Temp\ipykernel_16772\3039934652.py:33: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  kpsstest = kpss(timeseries, regression=&#34;c&#34;, nlags=&#34;auto&#34;)
C:\Users\User\AppData\Local\Temp\ipykernel_16772\3039934652.py:33: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  kpsstest = kpss(timeseries, regression=&#34;c&#34;, nlags=&#34;auto&#34;)
C:\Users\User\AppData\Local\Temp\ipykernel_16772\3039934652.py:33: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  kpsstest = kpss(timeseries, regression=&#34;c&#34;, nlags=&#34;auto&#34;)
C:\Users\User\AppData\Local\Temp\ipykernel_16772\3039934652.py:33: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  kpsstest = kpss(timeseries, regression=&#34;c&#34;, nlags=&#34;auto&#34;)
C:\Users\User\AppData\Local\Temp\ipykernel_16772\3039934652.py:33: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  kpsstest = kpss(timeseries, regression=&#34;c&#34;, nlags=&#34;auto&#34;)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">posteriorVAR</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">from_netcdf</span><span class="p">(</span><span class="s1">&#39;model_posterior_xs_v2.nc&#39;</span><span class="p">)</span>

<span class="n">posterior_samples</span> <span class="o">=</span> <span class="n">posteriorVAR</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;Ah&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute the median of the posterior samples</span>
<span class="n">median_Ah</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">posterior_samples</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function to check stability of a single matrix</span>
<span class="k">def</span><span class="w"> </span><span class="nf">is_stable</span><span class="p">(</span><span class="n">matrix</span><span class="p">):</span>
    <span class="n">eigenvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
    <span class="c1"># return all(np.sqrt(np.real(eigenvalue)**2 + np.imag(eigenvalue)**2) &lt; 1 for eigenvalue in eigenvalues)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>


<span class="c1"># Check stability of the median matrix</span>
<span class="n">stability_median_Ah</span> <span class="o">=</span> <span class="n">is_stable</span><span class="p">(</span><span class="n">median_Ah</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Median Ah matrix stability:&quot;</span><span class="p">,</span> <span class="n">stability_median_Ah</span><span class="p">)</span>
<span class="k">if</span> <span class="n">stability_median_Ah</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The median Ah matrix is stable.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The median Ah matrix is not stable.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Median Ah matrix stability: True
The median Ah matrix is stable.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function to check stability of a single matrix</span>
<span class="k">def</span><span class="w"> </span><span class="nf">is_stable</span><span class="p">(</span><span class="n">matrix</span><span class="p">):</span>
    <span class="n">eigenvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>


<span class="c1"># Check stability for each sampled matrix</span>
<span class="n">num_chains</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">,</span> <span class="n">nX</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">posterior_samples</span><span class="o">.</span><span class="n">shape</span>
<span class="n">stability_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_chains</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">))</span>

<span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_chains</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">):</span>
        <span class="n">stability_results</span><span class="p">[</span><span class="n">chain</span><span class="p">,</span> <span class="n">sample</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_stable</span><span class="p">(</span>
            <span class="n">posterior_samples</span><span class="p">[</span><span class="n">chain</span><span class="p">,</span> <span class="n">sample</span><span class="p">])</span>

<span class="c1"># Percentage of stable samples</span>
<span class="n">stable_percentage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">stability_results</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Percentage of stable samples: </span><span class="si">{</span><span class="n">stable_percentage</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">stable_percentage</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Not all samples are stable.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All samples are stable.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Percentage of stable samples: 87.48%
Warning: Not all samples are stable.
</pre></div></div>
</div>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">MIMIC</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Modelling and Inference of MICrobiomes Project (MIMIC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">mimic</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../examples.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../examples.html#jupyter-notebook-examples-by-model">Jupyter Notebook Examples by Model</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#consumer-resource-model-crm">Consumer Resource Model (CRM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#gaussian-processes-gp">Gaussian Processes (GP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#multivariate-autoregressive-model-mvar">Multivariate Autoregressive Model (MVAR)</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../../examples.html#multi-model-analysis">Multi-Model Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#vector-autoregression-var">Vector Autoregression (VAR)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#generalized-lotka-volterra-glv">Generalized Lotka-Volterra (gLV)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#generalized-metabolic-lotka-volterra-gmlv">Generalized Metabolic Lotka-Volterra (gMLV)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing to MIMIC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../history.html">History</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../examples.html">Examples</a><ul>
      <li>Previous: <a href="examples-Herold-VAR.html" title="previous chapter">VAR inference on a Real Public Dataset, Herold et al. (2020)</a></li>
      <li>Next: <a href="examples_impute_data.html" title="next chapter">Data imputation on a Real Public Dataset, Herold et al. (2020)</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Pedro Fontanarrosa.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../../_sources/notebooks/MultiModel/Herold/examples-Herold-sVAR.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>